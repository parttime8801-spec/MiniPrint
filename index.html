<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini Print Web App</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="manifest" href="manifest.json">
</head>

<body>

    <div class="app-container">
        <header>
            <h1>Mini Print</h1>
            <div id="status-indicator" class="status offline">
                <span class="dot"></span> <span id="status-text">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</span>
            </div>
        </header>

        <main>
            <!-- Connection Section -->
            <section class="card connection-card">
                <h2>‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå</h2>
                <p>‡πÄ‡∏õ‡∏¥‡∏î Bluetooth ‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á</p>
                <button id="connectBtn" class="btn primary-btn">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M5 12.55a11 11 0 0 1 14.08 0"></path>
                        <path d="M1.42 9a16 16 0 0 1 21.16 0"></path>
                        <path d="M8.53 16.11a6 6 0 0 1 6.95 0"></path>
                        <line x1="12" y1="20" x2="12.01" y2="20"></line>
                    </svg>
                    ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
                </button>
            </section>

            <!-- File Upload Section -->
            <section class="card upload-card">
                <h2>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ö‡∏¥‡∏• (PNG)</h2>
                <div class="file-drop-area" id="dropZone">
                    <span class="choose-file-button">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå</span>
                    <span class="file-message">‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</span>
                    <input class="file-input" type="file" id="fileInput" accept="image/png, image/jpeg">
                </div>
            </section>

            <!-- Preview Section -->
            <section class="preview-section" id="previewContainer" style="display: none;">
                <h3>‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡πà‡∏≠‡∏ô‡∏û‡∏¥‡∏°‡∏û‡πå</h3>
                <div class="preview-wrapper">
                    <img id="imagePreview" alt="Bill Preview">
                </div>

                <div class="controls">
                    <label>‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏° (Density): <span id="densityValue">127</span></label>
                    <input type="range" id="densitySlider" min="0" max="255" value="127">

                    <label style="margin-top: 10px;">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏© (Width):</label>
                    <select id="widthSelect" class="form-select"
                        style="width: 100%; padding: 8px; border-radius: 8px; border: 1px solid #ddd;">
                        <option value="384" selected>‡∏õ‡∏Å‡∏ï‡∏¥ (384 dots / 58mm)</option>
                        <option value="576">‡∏Å‡∏ß‡πâ‡∏≤‡∏á (576 dots / 80mm)</option>
                    </select>

                    <label
                        style="margin-top: 15px; display: flex; align-items: center; cursor: pointer; background: #f0f0f0; padding: 10px; border-radius: 8px;">
                        <input type="checkbox" id="autoTrim" checked
                            style="width: 20px; height: 20px; margin-right: 10px;">
                        <span>‡∏ï‡∏±‡∏î‡∏Ç‡∏≠‡∏ö‡∏Ç‡∏≤‡∏ß‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)</span>
                    </label>

                    <label style="margin-top: 10px;">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏°‡∏û‡πå (Speed):</label>
                    <select id="speedSelect" class="form-select"
                        style="width: 100%; padding: 8px; border-radius: 8px; border: 1px solid #ddd;">
                        <option value="turbo">üöÄ Turbo (‡∏•‡∏∑‡πà‡∏ô‡∏õ‡∏£‡∏∑‡πä‡∏î - ‡∏™‡πà‡∏á‡∏Å‡πâ‡∏≠‡∏ô‡πÉ‡∏´‡∏ç‡πà)</option>
                        <option value="10">‡πÄ‡∏£‡πá‡∏ß‡∏™‡∏∏‡∏î (10ms)</option>
                        <option value="30">‡πÄ‡∏£‡πá‡∏ß (30ms)</option>
                        <option value="50" selected>‡∏õ‡∏Å‡∏ï‡∏¥ (50ms - ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)</option>
                        <option value="100">‡∏ä‡πâ‡∏≤ (100ms - ‡πÅ‡∏Å‡πâ‡∏†‡∏≤‡∏û‡∏Ç‡∏≤‡∏î)</option>
                    </select>
                </div>

                <div class="actions">
                    <button id="printBtn" class="btn action-btn" disabled>
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <polyline points="6 9 6 2 18 2 18 9"></polyline>
                            <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
                            <rect x="6" y="14" width="12" height="8"></rect>
                        </svg>
                        ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                    </button>
                </div>
            </section>
        </main>
    </div>

    <script src="escpos.js"></script>
    <script src="app.js"></script>
    <script>
        // Register Service Worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(registration => {
                        console.log('ServiceWorker registration successful with scope: ', registration.scope);
                    })
                    .catch(err => {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }
    </script>
</body>

</html>